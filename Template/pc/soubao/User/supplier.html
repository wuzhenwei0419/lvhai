<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <title>账户管理-{$tpshop_config['shop_info_store_title']}</title>
    <meta http-equiv="keywords" content="{$tpshop_config['shop_info_store_keyword']}" />
    <meta name="description" content="{$tpshop_config['shop_info_store_desc']}" />
    <link rel="shortcut icon"  href="__STATIC__/images/favicon.ico" />
    <style>
        .Apply{
            width: 100%;
            height: 40vh;
        }
        .Apply img{
            /*width: 50px;*/
            /*height: 50px;*/
            font-size: 50px;
        }
        .cen{
            width: 440px;
            margin: 0 auto;
            font-size: 20px;
            font-weight: 800;
            color: black;
            line-height: 40px;
            margin-top: 150px;
        }
        .pass{
            font-size: 13px;
            color: #676767;
            line-height: 40px;
            margin-left: 60px;
            font-weight: 600;
        }
        .word{
            line-height: 18px;
        }
        .btn{
            width: 104px;
            height: 29px;
            background: #fa6c2c;
            font-size: 12px;
            color: white;
            text-align: center;
            line-height: 29px;
            margin-left: 70px;
            border-radius: 5px;
        }
        .icon_correct{
            width: 42px;
            height: 42px;
            line-height: 42px;
            background: -95px -172px;}
        .icon_big_warning{
            width: 49px;
            height: 42px;
            line-height: 42px;
            background: -95px -125px;
        }
        .error{
            width: 42px;
        }
        .we{
            margin-left: 58px;
            margin-top: 20px;
        }
        .tx_cash{
            margin-top: 20px;
        }
        .zhen{
            width: 76%;
            height: 140px;
            float: left;
            border-radius: 5px;
            box-sizing: border-box;
            border: 1px solid rgb(222, 222, 222);
        }
        .cash_submit{
            margin-left: -50px;
        }
        .input-sm{
            width:76%;
            height:30px;
            border: 1px solid #dedede;
            padding: 2px 10px;
            color: #9b9898;
            margin-top: 5px;
        }
    </style>
</head>
<body>
<!-- 头部-s -->
<include file="User/header" />
<!-- 头部-e -->
<link rel="stylesheet" href="__STATIC__/css/favorite.css">

<div class="wrap">
    <div class="bread_crumbs"> <a href="{:U('Home/User/index')}" class="crumbs_font">我的绿海</a>&gt;<span class="color">资金管理</span></div>
    <!--菜单-->
    <include file="User/menu" />
    <!--菜单-->
    <!--侧边导航栏结束-->
    <div class="col_main">
        <div class="main balance">
       <div class="themes_title">
        <h3>供应商申请</h3>
      </div>
            <div class="ui_tab">
                <!-- Details List star -->
                <if condition="$is_check eq 0">
                    <div class="ui_tab_content" style="border: 0">
                        <div class="ui_panel" id="noComment" style="display: block;">
                            <form action="" method="post" enctype="multipart/form-data" name="distribut_form" id="distribut_form" >
                                <div class="cash_num bb1" style="overflow: hidden;border: 0">
                                    <div class="tx_cash" style="float: left ;width: 40%;">
                                        <span>名称：</span>
                                        <input type="text" id="suppliers_name" name="suppliers_name"  class="imput_text vam" value="{$suppliers_name}" style="width: 70%"/>
                                    </div>
                                    <div class="tx_cash" style="float: left ;width: 40%;">
                                        <span>联系人：</span>
                                        <input type="text" id="suppliers_contacts" name="suppliers_contacts"  class="imput_text vam" value="{$suppliers_contacts}" style="width: 70%"/>
                                    </div>
                                    <div class="tx_cash" style="float: left ;width: 40%">
                                        <span>地址：</span>
                                        <input type="text" id="suppliers_address" name="suppliers_address"  class="imput_text vam" value="{$suppliers_address}" style="width: 70%"/>
                                    </div>
                                    <div class="tx_cash" style="float: left;width: 40%;overflow: hidden">
                                        <span>手机：</span>
                                        <input type="text" id="suppliers_phone" name="suppliers_phone"  class="phone_num vam" value="{$suppliers_phone}" style="width: 70%" />
                                    </div>
                                    <div class="tx_cash" style="width: 40%;float: left;
">
                                        <span>性质：</span>
                                        <select name="nature_id"  class="input-sm" onclick="Choice()">
                                            <option value="0">植户(个人)</option>
                                            <option value="1">贸易商（企业）</option>
                                        </select>
                                    </div>
                                    <div class="tx_cash" id="id" style="float: left;width: 40%;overflow: hidden">
                                        <span>身份证：</span>
                                        <input type="text" id="idcard" name="idcard"  class="phone_num vam" value="{$idcard}" style="width: 70%" />
                                    </div>
                                    <div class="tx_cash" id="por" style="float: left;width: 40%">
                                        <span  style="margin-top: 30px;">正面：</span>
                                        <div class="zhen" onclick="file('file')">
                                            <img  id="portrait" src="__STATIC__/images/1110_03.png" width="100%" height="100%">
                                            <input type="file" name="idcard_img1" class="file" style="display: none"  id="file"/>
                                            <input type="hidden" class="input-sm" name="idcard_img1" id="idcard_img1" value="{$idcard_img1}">
                                            <script type="text/javascript">
                                                function file(elementId) {
                                                    document.getElementById(elementId).click()
                                                }
                                                $("#file").change(function () {
                                                    var this_=this
                                                    var file = this_.files[0];
                                                    if (window.FileReader) {
                                                        var fr = new FileReader();
                                                        fr.onloadend = function(e) {
                                                            document.getElementById("portrait").src = e.target.result;
                                                        };
                                                        fr.readAsDataURL(file);
                                                    }
                                                    var formData = new FormData($( "#distribut_form" )[0]);
                                                    $.ajax({
                                                        url: "{:U('Home/User/suppliers_img1')}" ,
                                                        type: 'POST',
                                                        data: formData,
                                                        async: false,
                                                        cache: false,
                                                        contentType: false,
                                                        processData: false,
                                                        success: function (returndata) {
                                                            if(returndata=="上传失败"){
                                                                alert("上传失败")
                                                                setTimeout("   $(\"#portrait\").attr('src',\"__STATIC__/images/1110_03.png\")",10);

                                                            }else{
                                                                $('#portrait, #idcard_img1').val(returndata);
                                                                alert('上传成功');
                                                            }
                                                        },
                                                        error: function (returndata) {
                                                            console.log((returndata));
                                                        }
                                                    });
                                                })
                                            </script>

                                        </div>
                                    </div>
                                    <div class="tx_cash" id="trai" style="float: left;width: 40%">
                                        <span  style="margin-top: 30px;">反面：</span>
                                        <div class="zhen" onclick="file('fil')">
                                            <img id="portrai" src="__STATIC__/images/1110_03.png" width="100%" height="100%">
                                            <input type="file" name="idcard_img2"  class="file" style="display: none"  id="fil"/>
                                            <input type="hidden" class="input-sm" name="idcard_img2" id="idcard_img2" value="{$idcard_img2}">
                                            <script type="text/javascript">
                                                function file(elementId) {
                                                    document.getElementById(elementId).click()
                                                }
                                                $("#fil").change(function () {
                                                    var this_=this
                                                    var file = this_.files[0];
                                                    if (window.FileReader) {
                                                        var fr = new FileReader();
                                                        fr.onloadend = function(e) {
                                                            document.getElementById("portrai").src = e.target.result;
                                                        };
                                                        fr.readAsDataURL(file);
                                                    }
                                                    var formData = new FormData($( "#distribut_form" )[0]);
                                                    $.ajax({
                                                        url: "{:U('Home/User/suppliers_img2')}" ,
                                                        type: 'POST',
                                                        data: formData,
                                                        async: false,
                                                        cache: false,
                                                        contentType: false,
                                                        processData: false,
                                                        success: function (returndata) {
                                                            if(returndata=="上传失败"){
                                                                alert("上传失败")
                                                                setTimeout("   $(\"#portrai\").attr('src',\"__STATIC__/images/1110_03.png\")",10);
                                                            }else{
                                                                $('#portrai, #idcard_img2').val(returndata);
                                                                alert('上传成功');
                                                            }
                                                        },
                                                        error: function (returndata) {
                                                            alert(returndata);
                                                        }
                                                    });
                                                })
                                            </script>

                                        </div>
                                    </div>
                                    <div class="tx_cash" id="business" style="width: 40%;display: none">
                                        <span  style="margin-top: 30px;">营业执照：</span>
                                        <div class="zhen" onclick="fi('fi')"style="margin-top: 23px">
                                            <img id="supplier" src="__STATIC__/images/1110_03.png" width="100%" height="100%">
                                            <input type="file" name="business_licence"  class="file" style="display: none"  id="fi"/>
                                            <input type="hidden" class="input-sm" name="business_licence" id="business_licence" value="{$business_licence}">
                                            <script type="text/javascript">
                                                function fi(elementId) {
                                                    document.getElementById(elementId).click()
                                                }
                                                $("#fi").change(function () {
                                                    var this_=this
                                                    var file = this_.files[0];
                                                    if (window.FileReader) {
                                                        var fr = new FileReader();
                                                        fr.onloadend = function(e) {
                                                            document.getElementById("supplier").src = e.target.result;
                                                        };
                                                        fr.readAsDataURL(file);
                                                    }
                                                    var formData = new FormData($( "#distribut_form" )[0]);
                                                    $.ajax({
                                                        url: "{:U('Home/User/suppliers_img3')}" ,
                                                        type: 'POST',
                                                        data: formData,
                                                        async: false,
                                                        cache: false,
                                                        contentType: false,
                                                        processData: false,
                                                        success: function (returndata) {
                                                            if(returndata=="上传失败"){
                                                                alert("上传失败")
                                                                setTimeout("$(\"#supplier\").attr('src',\"__STATIC__/images/1110_03.png\")",10);
                                                            }else{
                                                                $('#supplier, #business_licence').val(returndata);
                                                                alert('上传成功');
                                                            }
                                                        },
                                                        error: function (returndata) {
                                                            alert(returndata);
                                                        }
                                                    });
                                                })
                                            </script>

                                        </div>
                                    </div>
                                    <div class="tx_cash" style="float:left;width: 100%;height:50px;overflow: hidden">
                                        <span>经营品种：</span>
                                        <input type="textfile" id="suppliers_desc" name="suppliers_desc"  class="phone_num vam" value="{$nature}" style="width: 70%;height:45px;border: 1px solid #dedede;" />
                                    </div>

                                    <div class="tx_cash" style="float: left ;width: 40%">
                                        <span>验证码：</span>
                                        <input type="text" name="verify_code" class="imput_text vam" id="verify_code" placeholder="请输入下面的验证码" style="width:150px;" />
                                        <img class="yzm_code" id="verify_code_img" width="100" height="30" src="{:U('User/supplier_verify')}"  onclick="verify(this)" />
                                    </div>
                                    <br>
                                    <div class="tx_cash" style="float: left ;width: 40%">
                                        <a id=""></a>
                                    </div>
                                    <br>
                                    <div class="tx_cash" style="float: left ;width: 40%;padding-top: 49px">
                                        <a id="cash_submit"  onClick="gt();"  style="margin-left: -50px;cursor:pointer">确定提交</a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <elseif condition="$is_check heq 1"/>
                    <div class="ui_tab_content"  style="border: 0">
                        <div class="ui_panel" id="noComment" style="display: block;">
                            <div class="Apply">
                                <div class="cen">
                                    <i class="icon_big_warning"></i>
                                    &nbsp;&nbsp; <span>您已提交申请，正在审核，请耐心等待</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <elseif condition="$is_check eq 2"/>
                    <div class="ui_tab_content"  style="border: 0">
                        <div class="ui_panel" id="noComment" style="display: block;">
                            <div class="Apply">
                                <div class="cen ok">
                                    <i class="icon_correct"></i>
                                    &nbsp;&nbsp;<span>恭喜您，申请成功</span>
         
                                </div>
                            </div>
                        </div>
                    </div>
                    <elseif condition="$is_check eq 3"/>
                    <div class="ui_tab_content"  style="border: 0">
                        <div class="ui_panel" id="noComment" style="display: block;">
                            <div class="Apply">
                                <div class="cen">
                                    <img src="__STATIC__/images/278212038171987408.png" alt="" class="error">
                                    &nbsp;&nbsp;<span>很遗憾，申请失败</span>
                                    <br>
                                    <a href="{:U('home/user/supplier')}">
                                        <button type="button" class="btn" onclick="del_pass()" >重新申请</button></a>

                                </div>
                            </div>
                        </div>
                    </div>
                </if>

            </div>
        </div>
    </div>
</div>

<div style="clear: both;"></div>
<include file="User/footer" />
</body>
<script>

    function Choice() {
        var input=document.querySelector(".input-sm")
        var business=document.querySelector("#business")
        var por=document.querySelector("#por")
        var trai=document.querySelector("#trai")
        var id=document.querySelector("#id")
        var index = input.selectedIndex
        var value = input.options[index].value;
        if(value==1){
            business.style.display="none"
            por.style.display="none"
            trai.style.display="none"
            id.style.display="none"
            business.style.display="block"
        }
        else{
            business.style.display="block"
            por.style.display="block"
            trai.style.display="block"
            id.style.display="block"
            business.style.display="none"
        }
    }
    // 表单验证提交
    function gt(){
        var input=document.querySelector(".input-sm")
        var index = input.selectedIndex
        var value = input.options[index].value;
        var suppliers_name = $.trim($('#suppliers_name').val());
        var suppliers_contacts = $.trim($('#suppliers_contacts').val());
        var suppliers_address = $.trim($('#suppliers_address').val());
        var suppliers_phone = $.trim($('#suppliers_phone').val());
        var idcard = $.trim($('#idcard').val());
        var suppliers_desc = $.trim($('#suppliers_desc').val());
        var verify_code = $.trim($('#verify_code').val());
        if(suppliers_name == '')
        {
            alert('请填写姓名');
            return false;
        }
        if(suppliers_contacts == '')
        {
            alert('联系人必填');
            return false;
        }
        if(suppliers_address == '')
        {
            alert('地址必填');
            return false;
        }
        if(suppliers_phone == '')
        {
            alert('手机必填');
            return false;
        }
        if(value==0){
        if(idcard == '')
        {
            alert('身份证必填');
            return false;
        }
        }
        if(suppliers_desc == '')
        {
            alert('经营品种必填');
            return false;
        }
        if(verify_code == '')
        {
            alert('验证码必填');
            return false;
        }

        $('#distribut_form').submit(
            $.ajax({
                type: "POST",
                url: "{:U('Home/User/add_supplier')}" ,
                data: $('#distribut_form').serialize(),
                success: function (data) {
                    window.location.reload()

                },
                error : function() {
                    alert("提交失败！");
                }
            })
        );
    }
    // 验证码切换
    function verify(){
        $('#verify_code_img').attr('src','/index.php?m=Home&c=User&a=supplier_verify&r='+Math.random());
    }
    function del_pass() {
        $.ajax({
            url:"{:U('User/del_supplier')}",
            type:"post",
            success: function (result) {
            },
            error : function() {
            }
        })
    }

</script>
</html>